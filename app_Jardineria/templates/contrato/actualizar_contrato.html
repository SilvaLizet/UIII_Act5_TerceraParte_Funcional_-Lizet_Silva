{% extends 'base.html' %}
{% block title %}Actualizar Contrato{% endblock %}

  {% block content %}
  <h2 class="mb-4 text-success">Actualizar Contrato de Servicio #{{ contrato.id }}</h2>
  <form method="post" class="p-4 border rounded shadow-sm bg-white">
      {% csrf_token %}
      <div class="mb-3">
          <label for="cliente" class="form-label">Cliente</label>
          <select class="form-select" id="cliente" name="cliente" required>
              {% for cli in clientes %}
                  <option value="{{ cli.id }}" {% if cli == contrato.cliente %}selected{% endif %}>{{ cli.nombre }} {{ cli.apellido }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="mb-3">
          <label for="servicio" class="form-label">Servicio</label>
          <select class="form-select" id="servicio" name="servicio" required>
              {% for serv in servicios %}
                  <option value="{{ serv.id }}" {% if serv == contrato.servicio %}selected{% endif %}>{{ serv.nombre_servicio }} - ${{ serv.precio|floatformat:2 }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="mb-3">
          <label for="empleados" class="form-label">Empleados Asignados (Selecciona uno o más con Ctrl/Cmd)</label>
          <select multiple class="form-select" id="empleados" name="empleados">
              {% for emp in empleados %}
                  <option value="{{ emp.id }}" {% if emp.id in empleados_seleccionados_ids %}selected{% endif %}>{{ emp.nombre }} {{ emp.apellido }} ({{ emp.puesto }})</option>
              {% endfor %}
          </select>
          <small class="form-text text-muted">Mantén 'Ctrl' (Windows) o 'Cmd' (Mac) para seleccionar múltiples empleados.</small>
      </div>
      <div class="mb-3">
          <label for="fecha_programada" class="form-label">Fecha Programada</label>
          <input type="date" class="form-control" id="fecha_programada" name="fecha_programada" value="{{ contrato.fecha_programada|date:'Y-m-d' }}" required>
      </div>
      <div class="mb-3">
          <label for="estado" class="form-label">Estado del Contrato</label>
          <select class="form-select" id="estado" name="estado" required>
              {% for choice_value, choice_label in contrato.estado_choices %}
                  <option value="{{ choice_value }}" {% if choice_value == contrato.estado %}selected{% endif %}>{{ choice_label }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="mb-3">
          <label for="observaciones" class="form-label">Observaciones</label>
          <textarea class="form-control" id="observaciones" name="observaciones" rows="3">{{ contrato.observaciones|default_if_none:"" }}</textarea>
      </div>
      <div class="mb-3">
          <label for="costo_total" class="form-label">Costo Total (opcional)</label>
          <input type="number" step="0.01" class="form-control" id="costo_total" name="costo_total" value="{{ contrato.costo_total|default_if_none:"" }}">
      </div>
      <button type="submit" class="btn btn-success me-2"><i class="fas fa-save me-2"></i>Actualizar Contrato</button>
      <a href="{% url 'ver_contratos' %}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Cancelar</a>
  </form>
  {% endblock %}
  ```